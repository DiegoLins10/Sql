USE [Beneflex-Sanofi]

BEGIN TRAN

	DECLARE @IdUsuarioTeste INT;
	DECLARE @IdFuncionarioTeste INT;
	DECLARE @IdStatusInativo int;

	DECLARE @Usuarios TABLE (CPF VARCHAR(15), IdUsuario INT NOT NULL, IdFuncionario int not null);

	INSERT INTO @Usuarios 
	SELECT u.CPF, u.idusuario, f.idfuncionario
	FROM seguranca.usuario u 
	INNER JOIN cadastro.funcionario f on u.idusuario = f.idusuario 
	WHERE u.admin is null and f.matricula IN ('W00002050','W00002704','W00002892','W00003656','W00004532','W00005870','W00006967','W00008924','W00010881','W00011101','W00012059','W00012069','W00012724','W00015352','W00022210','W00023646','W00023967','W00028859','W00030533','W00031915','W00032214','W00033092','W00037178','W00037646','W00043557','W00043560','W00043569','W00044495','W00046699','W00046967','W00048371','W00050364','W00052318','W00054034','W00054372','W00058011','W00058197','W00063413','W00064408','W00065138','W00065177','W00065202','W00065239','W00065480','W00065972','W00066050','W00066052','W00068213','W00069357','W00070315','W00070560','W00070562','W00071778','W00073849','W00073852','W00073855','W00075023','W00076034','W00076196','W00076742','W00077193','W00078731','W00081204','W00084322','W00085967','W00086746','W00087196','W00087331','W00087770','W00090233','W00091008','W00091121','W00091238','W00091296','W00093069','W00094468','W00095961','W00097305','W00098990','W00098991','W00098993','W00099008','W00099010','W00099013','W00099021','W00099027','W00099032','W00099034','W00099074','W00099081','W00099082','W00099084','W00099089','W00099090','W00099094','W00099095','W00099097','W00099099','W00099100','W00099102','W00099103','W00099106','W00099112','W00099117','W00099121','W00099123','W00099125','W00099126','W00099131','W00100363','W00100844','W00102010','W00102510','W00102528','W00103515','W00105352','W00106026','W00106281','W00106283','W00106289','W00106290','W00106304','W00106308','W00106311','W00106316','W00106318','W00106322','W00106324','W00106352','W00106357','W00106359','W00106361','W00106363','W00106366','W00106367','W00106368','W00106370','W00106372','W00106374','W00106375','W00106575','W50020149','W50023929','W50025346','W50025901','W50026114','W50026934','W50026935','W50027032','W50027039','W50027109','W50027328','W50028360','W50028891','W50028892','W50028894','W50028895','W50029087','W50031369','W50034169','W50034281','W50036203','W50037468','W50037542','W50038112','W50039022','W50039132','W50039193','W50040024','W50040708','W50040713','W50040781','W50042279','W50043344','W50043357','W50043491','W50043649','W50043879','W50043988','W50044063','W50044479','W50044487','W50045316','W50045326','W50046314','W50047556','W50047563','W50047594','W50047778','W50048160','W50048410','W50048492','W50048507','W50048653','W50049637','W50051145','W50053615','W50053942','W50055922','W50055970','W50057002','W50057958','W50058461','W50058811','W50059824','W50060047','W50061081','W50061092','W50061153','W50062308','W50063361','W50064226','W50065270','W50065960','W50065976','W50066430','W50067883','W50068880','W50068885','W50070801','W50071477','W50071557','W50071814','W50073011','W50073027','W50075486','W50075795','W50076495','W50077109','W50077237','W50077245','W50077957','W50078055','W50078069','W50080067','W50080070','W50080077','W50080140','W50080486','W50080488','W50081178','W50081407','W50081772','W50081955','W50081966','W50082045','W50082046','W50082333','W50082334','W50082341','W50082345','W50082996','W50084537','W50085243','W50086596','W50088882','W50090511','W50090584','W50090702','W50091047','W50092276','W50092512','W50092517','W50093739','W50094557','W50097100','W50097118','W50097694','W50098266','W50098268','W50099070','W50099163','W50099841','W50100309','W50100757','W50101352','W50102237','W50102957','W50103076','W50103194','W50103857','W50104154','W50104219','W50104282','W50104289','W50105196','W50105556','W50105709','W50105846','W50106213','W50107207','W50107461','W50107485','W50107598','W50108344','W50108575','W50108873','W50110036','W50110450','W50110452','W50110946','W50111118','W50111415','W50112495','W50112612','W50113572','W50114299','W50114303','W50114362','W50114365','W50114503','W50114981','W50115104','W50115189','W50115499','W50115608','W50115867','W50116799','W50116866','W50116928','W50117317','W50118549','W50118742','W50118826','W50119184','W50119288','W50119844','W50119851','W50119975','W50119981','W50120801','W50122442','W50122507','W50122521','W50123039','W50123044','W50123061','W50123292','W50123747','W50123861','W50123966','W50124106','W50124581','W50124592','W50124684','W50124689','W50124757','W50124905','W50124911','W50124917','W50124976','W50124985','W50124987','W50125072','W50125726','W50125822','W50125912','W50126290','W50126311','W50126374','W50126379','W50126397','W50126399','W50126887','W50127130','W50127133','W50127285','W50127950','W50127971','W50128048','W50128067','W50128163','W50128722','W50128727','W50128854','W50128871','W50129438','W50129784','W50130367','W50130372','W50130373','W50130384','W50130882','W50131436','W50131508','W50131509','W50131700','W50131703','W50131714','W50131888','W50131973','W50132295','W50132476','W50132807','W50132888','W50132951','W50133309','W50133313','W50133315','W50133376','W50133411','W50133414','W50133465','W50133496','W50134252','W50134320','W50134426','W50134435','W50134500','W50134544','W50134551','W50134835','W50134849','W50134914','W50134945','W50134960','W50135138','W50135150','W50135161','W50135162','W50135164','W50135299','W50135888','W50135959','W50135968','W50136161','W50136162','W50136396','W50136778','W50136780','W50136793','W50136897','W50137378','W50137440','W50137506','W50137660','W50138153','W50138273','W50138815','W50139248','W50139391','W50140310','W50140504','W50140723','W50140838','W50141284','W50141393','W50141394','W50141405','W50141415','W50141422','W50141517','W50141534','W50141537','W50141539','W50142749','W50142754','W50142756','W50142776','W50143021','W50143035','W50143168','W50143174','W50143199','W50143205','W90004075','W90023632','W90023636','W90023705','W90023854','W90023974','W90024094','W90024159','W90024261','W90024311','W90024317','W90024376','W90024385','W90024699','W90024837','W90024915','W90024923','W90024998','W90025021','W90025028','W90025215','W90025245','W90025381','W90025423','W90027378','W90048203','W90056835','W90057737','W90074390','W90091646','W90091844','W90092455','W90093534','W90096888','W90096954','W90104312','W90104421','W90104479','W90104497','W90104542','W90104593','W90104629','W90105019','W90106280','W90106478','W90107325','W90109175','W90111799','W90112761','W90112763','W90114004','W90114005','W90114024','W90117322','W90118023','W90118849','W90123088','W90125366','W90126478','W90127207','W90127800','W90128586','W90130743','W90132232','W90133551','W90138262','W90138850','W90140599','W90144532','W90144740','W90145014','W90146632','W90147414','W90148642','W90149467','W90152370','W90152880','W90153165','W90155869','W90156196','W90156585','W90161533','W90165483','W90165817','W90166188','W90168199','W90169202','W90171700','W50144236','W50144272')
	-- Caso preenchido usuário/funcionário para teste, faz somente com ele
	AND (@IdUsuarioTeste IS NULL OR u.IdUsuario = @IdUsuarioTeste)
	AND (@IdFuncionarioTeste IS NULL OR f.IdFuncionario = @IdFuncionarioTeste)

	SELECT @IdStatusInativo = idstatus FROM CADASTRO.STATUS WHERE tipostatus = 19 and tipoworkflow = 1

	UPDATE SEGURANCA.USUARIO SET IDSTATUS = @IdStatusInativo where idusuario in (select idusuario from @usuarios)
	UPDATE cadastro.dependente SET IDSTATUS = @IdStatusInativo where IDFUNCIONARIO in (select IDFUNCIONARIO from @usuarios)
	UPDATE requisicao.Cobertura set IdStatus = @IdStatusInativo where IdFuncionario in (select IDFUNCIONARIO from @usuarios)
	UPDATE requisicao.CoberturaDependente SET IdStatus  = @IdStatusInativo where IdCobertura in (SELECT C.IdCobertura from requisicao.Cobertura c inner join @Usuarios f on c.IdFuncionario = f.IdFuncionario)
	UPDATE requisicao.Solicitacao set IdStatus = @IdStatusInativo where IdUsuarioSolicitante in (SELECT IDUSUARIO FROM @Usuarios)

	SELECT idstatus from seguranca.Usuario  where idusuario in (select idusuario from @usuarios)

ROLLBACK
